<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UPC-E ‚Üí UPC-A Â§âÊèõ with „Éê„Éº„Ç≥„Éº„Éâ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.6/JsBarcode.all.min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1p&family=Noto+Sans+JP:wght@100..900&display=swap"
    rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans JP', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      padding: 40px;
      max-width: 900px;
      width: 100%;
    }

    /* „É¢„Éê„Ç§„É´ÂØæÂøú */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .container {
        padding: 20px;
        border-radius: 15px;
      }

      h1 {
        font-size: 1.5em !important;
      }
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-size: 2em;
    }

    .input-section {
      margin-bottom: 40px;
    }

    .input-label {
      display: block;
      margin-bottom: 10px;
      color: #666;
      font-weight: 600;
      text-align: center;
    }

    @media (max-width: 768px) {
      .input-label {
        font-size: 14px;
      }
    }

    .digit-inputs {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    @media (max-width: 480px) {
      .digit-inputs {
        gap: 5px;
      }
    }

    .digit-input {
      width: 60px;
      height: 60px;
      font-size: 24px;
      text-align: center;
      border: 3px solid #ddd;
      border-radius: 10px;
      transition: all 0.3s ease;
      font-weight: bold;
    }

    @media (max-width: 480px) {
      .digit-input {
        width: 45px;
        height: 45px;
        font-size: 20px;
        border-width: 2px;
      }
    }

    .digit-input:focus {
      outline: none;
      border-color: #667eea;
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
    }

    .digit-input.p6 {
      border-color: #f59e0b;
      background-color: #fef3c7;
    }

    /* „Çπ„Éî„É≥„Éú„Çø„É≥„ÇíÈùûË°®Á§∫ */
    .digit-input::-webkit-inner-spin-button,
    .digit-input::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .digit-input[type=number] {
      -moz-appearance: textfield;
    }

    .conversion-area {
      min-height: 290px;
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
      /* „Çπ„ÇØ„É≠„Éº„É´„Éê„ÉºÈò≤Ê≠¢ */
      overflow-x: hidden;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
    }

    @media (max-width: 768px) {
      .conversion-area {
        min-height: 300px;
        padding: 20px;
        margin-bottom: 20px;
      }
    }

    @media (max-width: 480px) {
      .conversion-area {
        padding: 2px;
        min-height: 280px;
      }
    }

    .pattern-info {
      background: #e0e7ff;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
      color: #4c1d95;
      opacity: 0;
      transition: opacity 0.5s ease;
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      word-break: break-all;
    }

    @media (max-width: 768px) {
      .pattern-info {
        font-size: 14px;
        padding: 12px;
        min-height: auto;
      }
    }

    @media (max-width: 480px) {
      .pattern-info {
        font-size: 12px;
        padding: 10px;
      }
    }

    .pattern-info.show {
      opacity: 1;
    }

    .barcode-display {
      display: flex;
      flex-direction: column;
      gap: 40px;
      position: relative;
      /* „Çπ„ÇØ„É≠„Éº„É´Èò≤Ê≠¢„ÅÆ„Åü„ÇÅ„ÅÆ‰ΩôÁôΩ */
      padding: 0 10px;
    }

    @media (max-width: 768px) {
      .barcode-display {
        gap: 30px;
        padding: 0;
      }
    }

    .barcode-wrapper {
      display: flex;
      align-items: center;
      position: relative;
      min-height: 54px;
      flex-direction: column;
      gap: 10px;
    }

    @media (min-width: 481px) {
      .barcode-wrapper {
        flex-direction: row;
        gap: 0;
      }
    }

    .barcode-label {
      font-size: 14px;
      color: #666;
      font-weight: 600;
      width: auto;
      text-align: center;
    }

    @media (min-width: 481px) {
      .barcode-label {
        position: absolute;
        left: 0;
        width: 80px;
        text-align: left;
      }
    }

    .barcode-row {
      display: flex;
      gap: 8px;
      min-height: 54px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }

    @media (min-width: 481px) {
      .barcode-row {
        margin-left: 70px;
        flex-wrap: nowrap;
        justify-content: flex-start;
      }
    }

    @media (max-width: 480px) {
      .barcode-row {
        gap: 0px;
      }
    }

    .digit-box {
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      border-radius: 8px;
      border: 2px solid #ddd;
      background: white;
      position: relative;
      transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @media (max-width: 768px) {
      .digit-box {
        width: 40px;
        height: 40px;
        font-size: 18px;
      }
    }

    @media (max-width: 480px) {
      .digit-box {
        width: 26px;
        height: 32px;
        font-size: 14px;
        border-radius: 6px;
      }
    }

    .digit-box.source {
      background: #dbeafe;
      border-color: #3b82f6;
    }

    .digit-box.zero {
      background: #dcfce7;
      border-color: #22c55e;
    }

    .digit-box.moved {
      background: #fef3c7;
      border-color: #f59e0b;
    }

    .digit-box.check {
      background: #fce7f3;
      border-color: #ec4899;
    }

    .digit-box.placeholder {
      background: white;
      border-color: #ddd;
      opacity: 1;
      visibility: visible;
    }

    .digit-box.animating {
      animation: pulse 0.6s ease-out;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
      }

      50% {
        transform: scale(1.1);
        box-shadow: 0 0 10px 5px rgba(102, 126, 234, 0);
      }

      100% {
        transform: scale(1);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .arrow {
      position: absolute;
      font-size: 30px;
      color: #667eea;
      animation: bounce 1s infinite;
      left: 50%;
      transform: translateX(-50%);
    }

    @media (max-width: 768px) {
      .arrow {
        font-size: 24px;
      }
    }

    @keyframes bounce {

      0%,
      100% {
        transform: translateX(-50%) translateY(0);
      }

      50% {
        transform: translateX(-50%) translateY(10px);
      }
    }

    .controls {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    @media (max-width: 480px) {
      .controls {
        gap: 10px;
        margin-bottom: 20px;
      }
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    @media (max-width: 480px) {
      .btn {
        padding: 10px 20px;
        font-size: 14px;
      }
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5a67d8;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-secondary:hover {
      background: #d1d5db;
    }

    .speed-control {
      display: flex;
      align-items: center;
      gap: 15px;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    @media (max-width: 480px) {
      .speed-control {
        gap: 10px;
      }
    }

    .speed-slider {
      width: 200px;
      max-width: 100%;
    }

    @media (max-width: 480px) {
      .speed-slider {
        width: 150px;
      }
    }

    .result-section {
      text-align: center;
      margin-top: 30px;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    @media (max-width: 768px) {
      .result-section {
        margin-top: 20px;
      }
    }

    .result-section.show {
      opacity: 1;
    }

    .result-section h3 {
      font-size: 18px;
      margin-bottom: 10px;
    }

    @media (max-width: 480px) {
      .result-section h3 {
        font-size: 16px;
      }
    }

    .result-code {
      font-size: 24px;
      font-family: 'Courier New', monospace;
      background: #f3f4f6;
      padding: 15px 30px;
      border-radius: 10px;
      margin: 10px auto;
      display: inline-block;
      word-break: break-all;
      max-width: 100%;
    }

    @media (max-width: 768px) {
      .result-code {
        font-size: 20px;
        padding: 12px 20px;
      }
    }

    @media (max-width: 480px) {
      .result-code {
        font-size: 16px;
        padding: 10px 15px;
      }
    }

    /* „Éê„Éº„Ç≥„Éº„ÉâË°®Á§∫„Ç®„É™„Ç¢„ÅÆ„Çπ„Çø„Ç§„É´ */
    .barcode-container {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      padding: 20px;
      margin: 20px auto;
      display: inline-block;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .barcode-container.show {
      opacity: 1;
    }

    @media (max-width: 768px) {
      .barcode-container {
        padding: 15px;
        margin: 15px auto;
      }
    }

    @media (max-width: 480px) {
      .barcode-container {
        padding: 10px;
        margin: 10px auto;
        max-width: 100%;
        overflow-x: auto;
      }
    }

    .barcode-svg {
      display: block;
      margin: 0 auto;
      max-width: 100%;
      height: auto;
    }

    @media (max-width: 480px) {
      .barcode-svg {
        width: 100%;
        min-width: 280px;
      }
    }

    .pattern-table {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-top: 30px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    @media (max-width: 768px) {
      .pattern-table {
        padding: 15px;
        margin-top: 20px;
      }
    }

    .pattern-table h3 {
      margin-bottom: 15px;
      color: #4b5563;
      font-size: 18px;
    }

    @media (max-width: 480px) {
      .pattern-table h3 {
        font-size: 16px;
        margin-bottom: 10px;
      }
    }

    .pattern-row {
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      transition: all 0.3s ease;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      word-break: break-all;
    }

    @media (max-width: 768px) {
      .pattern-row {
        font-size: 12px;
        padding: 8px;
      }
    }

    @media (max-width: 480px) {
      .pattern-row {
        font-size: 11px;
        padding: 6px;
      }
    }

    .pattern-row.active {
      background: #dbeafe;
      border: 2px solid #3b82f6;
      transform: scale(1.02);
    }

    .hidden {
      display: none;
    }

    .barcode-info {
      background: #e8f4fd;
      border: 1px solid #bfdbfe;
      border-radius: 8px;
      padding: 10px;
      margin-top: 10px;
      font-size: 12px;
      color: #1e40af;
    }

    @media (max-width: 480px) {
      .barcode-info {
        font-size: 11px;
        padding: 8px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>UPC-E ‚Üí UPC-A Â§âÊèõ</h1>

    <div class="input-section">
      <label class="input-label">UPC-E „Ç≥„Éº„ÉâÔºà6Ê°ÅÔºâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö</label>
      <div class="digit-inputs">
        <input type="number" class="digit-input" maxlength="1" id="p1" placeholder="X‚ÇÅ" inputmode="numeric" pattern="[0-9]" autofocus>
        <input type="number" class="digit-input" maxlength="1" id="p2" placeholder="X‚ÇÇ" inputmode="numeric" pattern="[0-9]">
        <input type="number" class="digit-input" maxlength="1" id="p3" placeholder="X‚ÇÉ" inputmode="numeric" pattern="[0-9]">
        <input type="number" class="digit-input" maxlength="1" id="p4" placeholder="X‚ÇÑ" inputmode="numeric" pattern="[0-9]">
        <input type="number" class="digit-input" maxlength="1" id="p5" placeholder="X‚ÇÖ" inputmode="numeric" pattern="[0-9]">
        <input type="number" class="digit-input p6" maxlength="1" id="p6" placeholder="P‚ÇÜ" inputmode="numeric" pattern="[0-9]">
      </div>
    </div>

    <div class="controls">
      <button class="btn btn-primary" onclick="startConversion()">Â§âÊèõÈñãÂßã</button>
      <button class="btn btn-secondary" onclick="reset()">„É™„Çª„ÉÉ„Éà</button>
    </div>

    <div class="speed-control">
      <label>„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈÄüÂ∫¶Ôºö</label>
      <input type="range" class="speed-slider" id="speedSlider" min="0.5" max="3" step="0.5" value="1">
      <span id="speedValue">1x</span>
    </div>

    <div class="conversion-area">
      <div class="pattern-info" id="patternInfo">&nbsp;</div>

      <div class="barcode-display">
        <div class="barcode-wrapper">
          <span class="barcode-label">UPC-E:</span>
          <div class="barcode-row" id="upceDisplay"></div>
        </div>

        <div class="arrow hidden" id="arrow" style="top: 50px;">‚Üì</div>

        <div class="barcode-wrapper">
          <span class="barcode-label">UPC-A:</span>
          <div class="barcode-row" id="upcaDisplay"></div>
        </div>
      </div>
    </div>

    <div class="result-section" id="resultSection">
      <h3>Â§âÊèõÁµêÊûú</h3>

      <!-- „Éê„Éº„Ç≥„Éº„ÉâË°®Á§∫„Ç®„É™„Ç¢Ôºàresult-code„ÇíÁΩÆ„ÅçÊèõ„ÅàÔºâ -->
      <div class="result-code" id="resultCode">
        <svg id="barcodeDisplay" class="barcode-svg"></svg>
      </div>
    </div>

    <div class="pattern-table">
      <h3>Â§âÊèõ„Éë„Çø„Éº„É≥‰∏ÄË¶ß</h3>
      <div class="pattern-row" id="pattern0">P6 = 0,1,2: 0 + X‚ÇÅX‚ÇÇ + P6 + 0000 + X‚ÇÉX‚ÇÑX‚ÇÖ + C</div>
      <div class="pattern-row" id="pattern3">P6 = 3: 0 + X‚ÇÅX‚ÇÇX‚ÇÉ + 00000 + X‚ÇÑX‚ÇÖ + C</div>
      <div class="pattern-row" id="pattern4">P6 = 4: 0 + X‚ÇÅX‚ÇÇX‚ÇÉX‚ÇÑ + 00000 + X‚ÇÖ + C</div>
      <div class="pattern-row" id="pattern5">P6 = 5-9: 0 + X‚ÇÅX‚ÇÇX‚ÇÉX‚ÇÑX‚ÇÖ + 0000 + P6 + C</div>
      <hr>
      <div style="margin-top: 15px; text-align: left; font-size: 14px;"><span style="margin-right:0.2rem;">üìñ ÂèÇÁÖß:</span>
        <a href="https://www.gs1jp.org/assets/img/pdf/GS1_General_Specifications.pdf" target="_blank"
          style="color: #667eea; text-decoration: none; ">
          GS1 General Specifications (PDF)
        </a>
      </div>
    </div>
  </div>

  <script>
    let animationSpeed = 1;

    // ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÅÆËá™Âãï„Éï„Ç©„Éº„Ç´„ÇπÁßªÂãï
    document.querySelectorAll('.digit-input').forEach((input, index, inputs) => {
      input.addEventListener('input', (e) => {
        // Êï∞Â≠ó‰ª•Â§ñ„ÅÆÊñáÂ≠ó„ÇíÈô§Âéª
        e.target.value = e.target.value.replace(/[^0-9]/g, '');

        if (e.target.value.length === 1 && index < inputs.length - 1) {
          inputs[index + 1].focus();
        }
      });

      input.addEventListener('keydown', (e) => {
        // Ë®±ÂèØ„Åô„Çã„Ç≠„Éº: Êï∞Â≠ó(0-9), Backspace, Delete, Tab, Arrow keys, Enter
        const allowedKeys = [
          'Backspace', 'Delete', 'Tab', 'Enter',
          'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
          'Home', 'End'
        ];

        // Êï∞Â≠ó„Ç≠„Éº(0-9)„Åæ„Åü„ÅØË®±ÂèØ„Åï„Çå„Åü„Ç≠„Éº„ÅÆÂ†¥Âêà„ÅØÈÄö„Åô
        const isDigit = /^[0-9]$/.test(e.key);
        const isAllowedKey = allowedKeys.includes(e.key);
        const isCtrlKey = e.ctrlKey || e.metaKey; // Ctrl+A, Ctrl+CÁ≠â„ÇíË®±ÂèØ

        if (!isDigit && !isAllowedKey && !isCtrlKey) {
          e.preventDefault();
          return;
        }

        // Backspace„Åß„ÅÆÂâç„Éï„Ç£„Éº„É´„Éâ„Å∏„ÅÆÁßªÂãï
        if (e.key === 'Backspace' && e.target.value === '' && index > 0) {
          inputs[index - 1].focus();
        }
      });

      input.addEventListener('focus', (e) => {
        e.target.select();
      });
    });

    // „Çπ„Éî„Éº„Éâ„Çπ„É©„Ç§„ÉÄ„Éº
    document.getElementById('speedSlider').addEventListener('input', (e) => {
      animationSpeed = parseFloat(e.target.value);
      document.getElementById('speedValue').textContent = animationSpeed + 'x';
    });

    function calculateCheckDigit(digits) {
      let sum = 0;
      for (let i = 0; i < 11; i++) {
        sum += parseInt(digits[i]) * (i % 2 === 0 ? 3 : 1);
      }
      return (10 - (sum % 10)) % 10;
    }

    function fallbackTextDisplay(upcCode) {
      const resultCode = document.getElementById('resultCode');
      resultCode.innerHTML = `<div style="font-family: 'Courier New', monospace; font-size: 24px; color: #333; text-align: center; padding: 20px; border: 2px dashed #ccc; border-radius: 8px;">
                <div style="margin-bottom: 10px; font-size: 18px; color: #666;">„Éê„Éº„Ç≥„Éº„ÉâÔºà„ÉÜ„Ç≠„Çπ„ÉàË°®Á§∫Ôºâ</div>
                <div>${upcCode}</div>
            </div>`;
    }

    function generateBarcode(upcCode) {
      // JsBarcode„É©„Ç§„Éñ„É©„É™„ÅÆÂ≠òÂú®Á¢∫Ë™ç
      if (typeof JsBarcode === 'undefined') {
        console.warn('JsBarcode library not loaded, using fallback text display');
        fallbackTextDisplay(upcCode);
        return;
      }

      // UPC„Ç≥„Éº„ÉâÊ°ÅÊï∞Ê§úË®ºÔºà12Ê°ÅÂøÖÈ†àÔºâ
      if (!upcCode || upcCode.length !== 12 || !/^\d{12}$/.test(upcCode)) {
        console.error('Invalid UPC code format:', upcCode, 'Expected 12 digits, got', upcCode.length, 'digits');
        fallbackTextDisplay(upcCode);
        return;
      }

      try {
        const svg = document.getElementById('barcodeDisplay');

        // SVG„Çí„ÇØ„É™„Ç¢
        svg.innerHTML = '';

        // JsBarcode„Åß„Éê„Éº„Ç≥„Éº„ÉâÁîüÊàê
        JsBarcode(svg, upcCode, {
          format: "UPC",
          width: 2,
          height: 80,
          lineColor: "#000000",
          background: "#ffffff",
          margin: 10,
          fontSize: 14,
          displayValue: true,
          fontOptions: "bold",
          textAlign: "center",
          textPosition: "bottom",
          textMargin: 2
        });

      } catch (error) {
        console.error('„Éê„Éº„Ç≥„Éº„ÉâÁîüÊàê„Ç®„É©„Éº:', error);
        console.error('UPC Code:', upcCode, 'Length:', upcCode.length);
        // „Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÅØ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØË°®Á§∫
        fallbackTextDisplay(upcCode);
      }
    }

    async function startConversion() {
      const p1 = document.getElementById('p1').value;
      const p2 = document.getElementById('p2').value;
      const p3 = document.getElementById('p3').value;
      const p4 = document.getElementById('p4').value;
      const p5 = document.getElementById('p5').value;
      const p6 = document.getElementById('p6').value;

      if (!p1 || !p2 || !p3 || !p4 || !p5 || !p6) {
        alert('„Åô„Åπ„Å¶„ÅÆÊ°Å„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
      }

      // Êï∞Â≠ó„ÉÅ„Çß„ÉÉ„ÇØ
      if (!/^\d$/.test(p1) || !/^\d$/.test(p2) || !/^\d$/.test(p3) ||
        !/^\d$/.test(p4) || !/^\d$/.test(p5) || !/^\d$/.test(p6)) {
        alert('Êï∞Â≠ó„ÅÆ„Åø„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
      }

      // „É™„Çª„ÉÉ„Éà
      reset();

      // UPC-EË°®Á§∫Ôºà6Ê°ÅÂêåÊôÇ„Å´Âæê„ÄÖ„Å´Â§âÂåñÔºâ
      const upceDisplay = document.getElementById('upceDisplay');
      const existingPlaceholders = upceDisplay.querySelectorAll('.digit-box.placeholder');

      const upceDigits = [p1, p2, p3, p4, p5, p6];
      const upceBoxes = [];

      // „Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„ÇíÊÆµÈöéÁöÑ„Å´Â§âÊõ¥ÔºàÁΩÆÊèõ„Å™„ÅóÔºâ
      upceDigits.forEach((digit, index) => {
        const placeholder = existingPlaceholders[index];
        if (placeholder) {
          upceBoxes.push(placeholder);
        }
      });

      await sleep(500 / animationSpeed);

      // 6Ê°Å„ÇíÂêåÊôÇ„Å´ÊÆµÈöéÁöÑÂ§âÂåñ
      upceBoxes.forEach((box, index) => {
        const digit = upceDigits[index];
        const className = index < 5 ? 'source' : 'moved';

        // „ÉÜ„Ç≠„Çπ„Éà„ÇíË®≠ÂÆö
        box.textContent = digit;

        // Áü≠„ÅÑÈÅÖÂª∂Âæå„Å´Ëâ≤„ÇíÂ§âÊõ¥
        setTimeout(() => {
          box.className = `digit-box ${className}`;
          box.classList.add('animating');
        }, 50);
      });

      //await sleep(500 / animationSpeed);

      // „Éë„Çø„Éº„É≥ÊÉÖÂ†±Ë°®Á§∫
      const patternInfo = document.getElementById('patternInfo');
      const p6Value = parseInt(p6);
      let pattern = '';
      let patternId = '';

      if (p6Value >= 0 && p6Value <= 2) {
        pattern = `P6 = ${p6} „ÅÆ„Éë„Çø„Éº„É≥: 0 + ${p1}${p2} + ${p6} + 0000 + ${p3}${p4}${p5} + C`;
        patternId = 'pattern0';
      } else if (p6Value === 3) {
        pattern = `P6 = 3 „ÅÆ„Éë„Çø„Éº„É≥: 0 + ${p1}${p2}${p3} + 00000 + ${p4}${p5} + C`;
        patternId = 'pattern3';
      } else if (p6Value === 4) {
        pattern = `P6 = 4 „ÅÆ„Éë„Çø„Éº„É≥: 0 + ${p1}${p2}${p3}${p4} + 00000 + ${p5} + C`;
        patternId = 'pattern4';
      } else {
        pattern = `P6 = ${p6} „ÅÆ„Éë„Çø„Éº„É≥: 0 + ${p1}${p2}${p3}${p4}${p5} + 0000 + ${p6} + C`;
        patternId = 'pattern5';
      }

      patternInfo.textContent = pattern;
      patternInfo.classList.add('show');

      // „Éë„Çø„Éº„É≥„ÉÜ„Éº„Éñ„É´„ÅÆ„Éè„Ç§„É©„Ç§„Éà
      document.querySelectorAll('.pattern-row').forEach(row => row.classList.remove('active'));
      document.getElementById(patternId).classList.add('active');

      await sleep(500 / animationSpeed);

      // Áü¢Âç∞Ë°®Á§∫
      document.getElementById('arrow').classList.remove('hidden');

      await sleep(200 / animationSpeed);

      // UPC-AÁîüÊàê
      const upcaDisplay = document.getElementById('upcaDisplay');
      const existingUpcaPlaceholders = upcaDisplay.querySelectorAll('.digit-box.placeholder');

      let upcaDigits = [];

      // ÂÖàÈ†≠„ÅÆ0
      upcaDigits.push('0');

      // „Éë„Çø„Éº„É≥„Å´Âøú„Åò„ÅüÂ§âÊèõ
      if (p6Value >= 0 && p6Value <= 2) {
        upcaDigits.push(p1, p2, p6, '0', '0', '0', '0', p3, p4, p5);
      } else if (p6Value === 3) {
        upcaDigits.push(p1, p2, p3, '0', '0', '0', '0', '0', p4, p5);
      } else if (p6Value === 4) {
        upcaDigits.push(p1, p2, p3, p4, '0', '0', '0', '0', '0', p5);
      } else {
        upcaDigits.push(p1, p2, p3, p4, p5, '0', '0', '0', '0', p6);
      }

      // „ÉÅ„Çß„ÉÉ„ÇØ„Éá„Ç£„Ç∏„ÉÉ„ÉàË®àÁÆó
      const checkDigit = calculateCheckDigit(upcaDigits);
      upcaDigits.push(checkDigit.toString());

      // ÊÆµÈöéÁöÑÂ§âÂåñË°®Á§∫Ôºà„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„Åã„ÇâÂæê„ÄÖ„Å´Â§âÊõ¥Ôºâ
      const upcaBoxes = [];

      // „Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„ÇíÊÆµÈöéÁöÑ„Å´Â§âÊõ¥„Åô„ÇãÊ∫ñÂÇô
      for (let i = 0; i < upcaDigits.length; i++) {
        const placeholder = existingUpcaPlaceholders[i];
        if (placeholder) {
          upcaBoxes.push(placeholder);
        }
      }

      // ÊúÄÂàù„Å´ÂÖàÈ†≠0„ÇíË°®Á§∫
      await sleep(150 / animationSpeed);
      if (upcaBoxes[0]) {
        upcaBoxes[0].textContent = upcaDigits[0];
        setTimeout(() => {
          upcaBoxes[0].className = 'digit-box zero';
          upcaBoxes[0].classList.add('animating');
        }, 50);
      }

      await sleep(800 / animationSpeed);

      // ÊÆµÈöéÁöÑË°®Á§∫: p1, p2, p3, p4, p5„Çí1„Å§„Åö„Å§ÔºàÂÖÉ„ÅÆUPC-EÈ†ÜÂ∫è„ÅßÔºâ
      const sourceIndices = [];
      for (let i = 1; i < upcaDigits.length - 1; i++) {
        if (upcaDigits[i] !== '0') {
          // movedÂà§ÂÆö„ÅÆ„Åü„ÇÅ„ÅÆ„ÇØ„É©„ÇπÂêç„Çí‰∫ãÂâçË®àÁÆó
          let willBeMoved = false;
          if ((p6Value >= 0 && p6Value <= 2) && i === 3) willBeMoved = true;
          else if (p6Value >= 5 && p6Value <= 9 && i === 10) willBeMoved = true;

          if (!willBeMoved) {
            sourceIndices.push(i);
          }
        }
      }

      await sleep(800 / animationSpeed);

      for (const index of sourceIndices) {
        await sleep(150 / animationSpeed);
        if (upcaBoxes[index]) {
          upcaBoxes[index].textContent = upcaDigits[index];
          setTimeout(() => {
            upcaBoxes[index].className = 'digit-box source';
            upcaBoxes[index].classList.add('animating');
          }, 50);
        }
      }

      await sleep(800 / animationSpeed);

      // p6„ÇíË°®Á§∫Ôºàmoved classÔºâ
      let p6Index = -1;
      if (p6Value >= 0 && p6Value <= 2) p6Index = 3;
      else if (p6Value >= 5 && p6Value <= 9) p6Index = 10;

      if (p6Index !== -1 && upcaBoxes[p6Index]) {
        await sleep(150 / animationSpeed);
        upcaBoxes[p6Index].textContent = upcaDigits[p6Index];
        setTimeout(() => {
          upcaBoxes[p6Index].className = 'digit-box moved';
          upcaBoxes[p6Index].classList.add('animating');
        }, 50);
      }

      await sleep(800 / animationSpeed);

      // 0„Çí1„Å§„Åö„Å§Ë°®Á§∫ÔºàÂÖàÈ†≠0‰ª•Â§ñÔºâ
      for (let i = 1; i < upcaBoxes.length - 1; i++) {
        if (upcaDigits[i] === '0' && upcaBoxes[i] && upcaBoxes[i].textContent === '') {
          await sleep(100 / animationSpeed);
          upcaBoxes[i].textContent = '0';
          setTimeout(() => {
            upcaBoxes[i].className = 'digit-box zero';
            upcaBoxes[i].classList.add('animating');
          }, 50);
        }
      }

      await sleep(800 / animationSpeed);

      // „ÉÅ„Çß„ÉÉ„ÇØ„Éá„Ç£„Ç∏„ÉÉ„Éà„ÇíË°®Á§∫
      await sleep(150 / animationSpeed);
      const lastBox = upcaBoxes[upcaBoxes.length - 1];
      if (lastBox) {
        lastBox.textContent = upcaDigits[upcaDigits.length - 1];
        setTimeout(() => {
          lastBox.className = 'digit-box check';
          lastBox.classList.add('animating');
        }, 50);
      }

      await sleep(1000 / animationSpeed);

      // ÁµêÊûúË°®Á§∫„Å®„Éê„Éº„Ç≥„Éº„ÉâÁîüÊàê
      const resultSection = document.getElementById('resultSection');
      const upcCode = upcaDigits.join(''); // „ÉÅ„Çß„ÉÉ„ÇØ„Éá„Ç£„Ç∏„ÉÉ„ÉàËæº„Åø12Ê°Å

      resultSection.classList.add('show');

      // Â∞ë„ÅóÈÅÖÂª∂„Åó„Å¶„Éê„Éº„Ç≥„Éº„ÉâÁîüÊàê
      await sleep(500 / animationSpeed);
      generateBarcode(upcCode);
    }

    function createDigitBox(digit, className) {
      const box = document.createElement('div');
      box.classList.add('digit-box', className);
      box.textContent = digit;
      return box;
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function reset() {
      const upceDisplay = document.getElementById('upceDisplay');
      const upcaDisplay = document.getElementById('upcaDisplay');
      const arrow = document.getElementById('arrow');
      const patternInfo = document.getElementById('patternInfo');
      const resultSection = document.getElementById('resultSection');
      const barcodeDisplay = document.getElementById('barcodeDisplay');

      // Êó¢Â≠òË¶ÅÁ¥†„Çí„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„Å´Â§âÊèõ„Åæ„Åü„ÅØ„ÇØ„É™„Ç¢ÔºàinnerHTML‰ΩøÁî®ÂõûÈÅøÔºâ
      if (upceDisplay) {
        const existingBoxes = upceDisplay.querySelectorAll('.digit-box');
        // Êó¢Â≠òË¶ÅÁ¥†„Çí„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„Å´Â§âÊèõ
        existingBoxes.forEach(box => {
          box.className = 'digit-box placeholder';
          box.textContent = '';
          box.style.opacity = '1';
          box.style.visibility = 'visible';
        });

        // ‰∏çË∂≥ÂàÜ„ÇíËøΩÂä†
        const needed = 6 - existingBoxes.length;
        for (let i = 0; i < needed; i++) {
          const placeholderE = document.createElement('div');
          placeholderE.classList.add('digit-box', 'placeholder');
          upceDisplay.appendChild(placeholderE);
        }
      }

      if (upcaDisplay) {
        const existingBoxes = upcaDisplay.querySelectorAll('.digit-box');
        // Êó¢Â≠òË¶ÅÁ¥†„Çí„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„Å´Â§âÊèõ
        existingBoxes.forEach(box => {
          box.className = 'digit-box placeholder';
          box.textContent = '';
          box.style.opacity = '1';
          box.style.visibility = 'visible';
        });

        // ‰∏çË∂≥ÂàÜ„ÇíËøΩÂä†
        const needed = 12 - existingBoxes.length;
        for (let i = 0; i < needed; i++) {
          const placeholderA = document.createElement('div');
          placeholderA.classList.add('digit-box', 'placeholder');
          upcaDisplay.appendChild(placeholderA);
        }
      }

      if (arrow) arrow.classList.add('hidden');
      if (patternInfo) {
        patternInfo.classList.remove('show');
        patternInfo.innerHTML = '&nbsp;';
      }
      if (resultSection) resultSection.classList.remove('show');
      if (barcodeDisplay) barcodeDisplay.innerHTML = '';
      document.querySelectorAll('.pattern-row').forEach(row => row.classList.remove('active'));
    }

    // JsBarcode„É©„Ç§„Éñ„É©„É™„ÅÆË™≠„ÅøËæº„ÅøÁ¢∫Ë™ç
    function checkJsBarcodeLoaded() {
      if (typeof JsBarcode === 'undefined') {
        console.warn('JsBarcode library not loaded. Barcode generation will use text fallback.');
        return false;
      }
      //console.log('JsBarcode library loaded successfully');
      return true;
    }

    // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñÔºàDOMContentLoadedÔºâ
    window.addEventListener('DOMContentLoaded', () => {
      reset();
    });

    // „É©„Ç§„Éñ„É©„É™Ë™≠„ÅøËæº„ÅøÁ¢∫Ë™çÔºàwindow.loadÔºâ
    window.addEventListener('load', () => {
      checkJsBarcodeLoaded();
    });

    // ÁîªÈù¢ÂπÖ„Å´Âøú„Åò„Å¶Áü¢Âç∞„ÅÆ‰ΩçÁΩÆ„ÇíË™øÊï¥
    function adjustArrowPosition() {
      const arrow = document.getElementById('arrow');
      if (window.innerWidth <= 480) {
        arrow.style.top = '70px';
      } else {
        arrow.style.top = '45px';
      }
    }

    window.addEventListener('resize', adjustArrowPosition);
    window.addEventListener('DOMContentLoaded', adjustArrowPosition);
  </script>
</body>

</html>
