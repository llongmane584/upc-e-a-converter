<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UPC-E ‚Üí UPC-A Converter</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.6/JsBarcode.all.min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <style>
    :root {
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --surface: #ffffff;
      --bg-color: #f1f5f9; /* „Çπ„É¨„Éº„Éà„Ç∞„É¨„Éº */
      --text-main: #0f172a;
      --text-sub: #64748b;
      --border: #cbd5e1;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --radius: 12px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans JP', sans-serif;
    }

    body {
      background-color: var(--bg-color);
      /* ÂæÆÁ¥∞„Å™„Éâ„ÉÉ„Éà„Éë„Çø„Éº„É≥ */
      background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
      background-size: 20px 20px;
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    @media (max-width: 640px) {
      body { padding: 8px; }
    }
    
    @media (max-width: 420px) {
      body { padding: 0; }
    }

    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast {
      padding: 12px 20px;
      border-radius: 6px;
      color: white;
      font-weight: 500;
      font-size: 14px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      animation: slideIn 0.3s ease-out forwards;
      cursor: pointer;
      display: flex;
      align-items: center;
    }

    .toast.error { background-color: #ef4444; }
    .toast.success { background-color: #10b981; }
    .toast.fade-out { animation: fadeOut 0.3s ease-out forwards; }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes fadeOut {
      to { transform: translateX(100%); opacity: 0; }
    }

    .container {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 40px;
      max-width: 800px;
      width: 100%;
      border: 1px solid rgba(255,255,255,0.5);
    }

    h1 {
      text-align: center;
      color: var(--text-main);
      margin-bottom: 10px;
      font-size: 1.8em;
      font-weight: 700;
      letter-spacing: -0.02em;
    }
    
    .subtitle {
      text-align: center;
      color: var(--text-sub);
      font-size: 0.9em;
      margin-bottom: 30px;
    }

    .input-section {
      margin-bottom: 30px;
      /* background: #f8fafc; */
      padding: 24px;
      /* border-radius: var(--radius); */
      /* border: 1px solid #e2e8f0; */
    }

    .input-label {
      display: block;
      margin-bottom: 16px;
      color: var(--text-sub);
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      text-align: center;
    }

    .digit-inputs {
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    .digit-input {
      width: 56px;
      height: 64px;
      font-size: 28px;
      text-align: center;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: white;
      transition: all 0.2s ease;
      font-weight: 600;
      color: var(--text-main);
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .digit-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      transform: translateY(-1px);
    }

    .digit-input.p6 {
      border-color: #f59e0b;
      background-color: #fffbeb;
      color: #b45309;
    }

    /* Remove spinner */
    .digit-input::-webkit-inner-spin-button, .digit-input::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

    .conversion-area {
      min-height: 240px;
      padding: 20px 0;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    
    @media (max-width: 640px) {
      .conversion-area { padding: 15px 0; margin-bottom: 15px; }
    }

    .pattern-info {
      background: #eef2ff;
      padding: 12px 20px;
      border-radius: 6px;
      margin-bottom: 24px;
      text-align: center;
      font-size: 0.9rem;
      font-weight: 500;
      color: #3730a3;
      border: 1px solid #c7d2fe;
      opacity: 0;
      transition: opacity 0.3s ease;
      min-height: 46px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .pattern-info.show { opacity: 1; }

    .barcode-display {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .barcode-wrapper {
      display: flex;
      align-items: center;
      gap: 16px;
      width: 100%;
      justify-content: center;
    }
    
    @media (max-width: 640px) {
      .barcode-wrapper {
        flex-direction: column;
        gap: 8px;
      }
    }

    .barcode-label {
      font-size: 0.75rem;
      color: var(--text-sub);
      font-weight: 700;
      text-transform: uppercase;
      width: 60px;
      text-align: right;
    }
    
    @media (max-width: 640px) {
      .barcode-label { text-align: center; width: auto; }
    }

    .barcode-row {
      display: flex;
      gap: 6px;
      min-height: 50px;
      align-items: center;
    }
    
    @media (max-width: 640px) {
      .barcode-row { gap: 3px; }
    }
    
    @media (max-width: 420px) {
      .barcode-row { gap: 2px; }
    }

    .digit-box {
      width: 44px;
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 600;
      border-radius: 6px;
      border: 1px solid #e2e8f0;
      background: white;
      color: var(--text-main);
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @media (max-width: 640px) {
      .digit-box { width: 28px; height: 38px; font-size: 14px; }
    }
    
    @media (max-width: 420px) {
      .digit-box { width: 26px; height: 36px; font-size: 16px; }
    }
    /*
    @media (max-width: 360px) {
      .digit-box { width: 26px; height: 34px; font-size: 14px; padding: 2px; }
    }*/

    /* Semantic Colors - Modernized */
    .digit-box.source { background: #eff6ff; border-color: #93c5fd; color: #1d4ed8; }
    .digit-box.zero { background: #f0fdf4; border-color: #86efac; color: #15803d; }
    .digit-box.moved { background: #fff7ed; border-color: #fdba74; color: #c2410c; }
    .digit-box.check { background: #fdf2f8; border-color: #f9a8d4; color: #be185d; }
    
    .digit-box.placeholder {
      background: #f8fafc;
      border-color: #e2e8f0;
    }

    .digit-box.animating {
      animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }

    .arrow {
      color: var(--text-sub);
      margin: 10px 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .arrow svg {
      width: 32px;
      height: 32px;
      fill: currentColor;
    }

    .controls {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-bottom: 24px;
    }

    .btn {
      padding: 12px 28px;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-primary {
      background: var(--text-main); /* „Éà„É¨„É≥„Éâ„ÅÆÈªí„Å´Ëøë„ÅÑ„Ç∞„É¨„Éº */
      color: white;
      box-shadow: 0 4px 6px -1px rgba(15, 23, 42, 0.2);
    }

    .btn-primary:hover:not(:disabled) {
      background: black;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: white;
      color: var(--text-main);
      border: 1px solid #d1d5db;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #f9fafb;
      border-color: #9ca3af;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    .speed-control {
      display: flex;
      align-items: center;
      gap: 12px;
      justify-content: center;
      padding: 10px;
      border-radius: 8px;
      /* background: #f8fafc; */
      margin: 0 auto 20px;
      max-width: 300px;
    }
    
    .speed-control label {
      font-size: 0.8rem;
      color: var(--text-sub);
      font-weight: 500;
    }

    .speed-slider {
      accent-color: var(--text-main);
      cursor: pointer;
    }

    .result-section {
      margin-top: 30px;
      padding-top: 30px;
      border-top: 1px dashed #e2e8f0;
      text-align: center;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .result-section.show { opacity: 1; }

    .result-code {
      background: white;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      margin: 16px auto;
      display: inline-block;
    }

    .pattern-table {
      margin-top: 40px;
      background: #f8fafc;
      border-radius: 8px;
      padding: 20px;
      border: 1px solid #e2e8f0;
    }

    .pattern-table h3 {
      font-size: 0.9rem;
      color: var(--text-sub);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .pattern-row {
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.85rem;
      padding: 8px 12px;
      margin-bottom: 4px;
      border-radius: 4px;
      color: var(--text-sub);
      transition: all 0.3s ease;
    }

    .pattern-row.active {
      background: white;
      color: var(--primary);
      font-weight: 700;
      border-left: 3px solid var(--primary);
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .reference-link {
      display: inline-flex;
      align-items: center;
      margin-top: 16px;
      font-size: 0.8rem;
      color: var(--text-sub);
      text-decoration: none;
    }
    
    .reference-link:hover {
      color: var(--primary);
      text-decoration: underline;
    }

    .hidden { display: none; }
    
    @media (max-width: 767px) {
      .container { padding: 20px; }
      .digit-input { width: 44px; height: 50px; font-size: 22px; }
    }
    
    @media (max-width: 420px) {
      .container { padding: 10px; border-radius: 0; }
      .digit-input { width: 38px; height: 46px; font-size: 19px; }
      .digit-inputs { gap: 3px; }
      .input-section { padding: 12px; }
    }
  </style>
</head>

<body>
  <div class="toast-container" id="toastContainer"></div>
  <div class="container">
    <h1>UPC Converter</h1>

    <div class="input-section">
      <label class="input-label">UPC-E „Ç≥„Éº„ÉâÔºà6Ê°ÅÔºâ„ÇíÂÖ•Âäõ</label>
      <div class="digit-inputs">
        <input type="number" class="digit-input" maxlength="1" id="p1" placeholder="X" inputmode="numeric" pattern="[0-9]" autofocus>
        <input type="number" class="digit-input" maxlength="1" id="p2" placeholder="X" inputmode="numeric" pattern="[0-9]">
        <input type="number" class="digit-input" maxlength="1" id="p3" placeholder="X" inputmode="numeric" pattern="[0-9]">
        <input type="number" class="digit-input" maxlength="1" id="p4" placeholder="X" inputmode="numeric" pattern="[0-9]">
        <input type="number" class="digit-input" maxlength="1" id="p5" placeholder="X" inputmode="numeric" pattern="[0-9]">
        <input type="number" class="digit-input p6" maxlength="1" id="p6" placeholder="P" inputmode="numeric" pattern="[0-9]">
      </div>
    </div>

    <div class="controls">
      <button class="btn btn-primary" onclick="startConversion()">Â§âÊèõ„ÇíÂÆüË°å</button>
      <button class="btn btn-secondary" onclick="reset()">„É™„Çª„ÉÉ„Éà</button>
    </div>

    <div class="speed-control">
      <label style="white-space: nowrap;">„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈÄüÂ∫¶Ôºö</label>
      <input type="range" class="speed-slider" id="speedSlider" min="0.5" max="3" step="0.5" value="1">
      <span id="speedValue" style="font-size: 0.8rem; font-weight: 600; width: 30px;">1x</span>
    </div>

    <div class="conversion-area">
      <div class="pattern-info" id="patternInfo">&nbsp;</div>

      <div class="barcode-display">
        <div class="barcode-wrapper">
          <span class="barcode-label">UPC-E</span>
          <div class="barcode-row" id="upceDisplay"></div>
        </div>

        <div class="arrow" id="arrow">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M18 6.41 16.59 5 12 9.58 7.41 5 6 6.41l6 6z"/>
            <path d="m18 13-1.41-1.41L12 16.17l-4.59-4.58L6 13l6 6z"/>
          </svg>
        </div>

        <div class="barcode-wrapper">
          <span class="barcode-label">UPC-A</span>
          <div class="barcode-row" id="upcaDisplay"></div>
        </div>
      </div>
    </div>

    <div class="result-section" id="resultSection">
      <h3 style="font-size: 0.9rem; color: var(--text-sub); text-transform: uppercase; letter-spacing: 0.05em;">Result Barcode</h3>
      <div class="result-code" id="resultCode">
        <svg id="barcodeDisplay" class="barcode-svg"></svg>
      </div>
    </div>

    <div class="pattern-table">
      <h3>Â§âÊèõ„Éë„Çø„Éº„É≥‰∏ÄË¶ß</h3>
      <div class="pattern-row" id="pattern0">P6 = 0,1,2: 0 + X‚ÇÅX‚ÇÇ + P6 + 0000 + X‚ÇÉX‚ÇÑX‚ÇÖ + C</div>
      <div class="pattern-row" id="pattern3">P6 = 3: 0 + X‚ÇÅX‚ÇÇX‚ÇÉ + 00000 + X‚ÇÑX‚ÇÖ + C</div>
      <div class="pattern-row" id="pattern4">P6 = 4: 0 + X‚ÇÅX‚ÇÇX‚ÇÉX‚ÇÑ + 00000 + X‚ÇÖ + C</div>
      <div class="pattern-row" id="pattern5">P6 = 5-9: 0 + X‚ÇÅX‚ÇÇX‚ÇÉX‚ÇÑX‚ÇÖ + 0000 + P6 + C</div>
      
      <a href="https://www.gs1jp.org/assets/img/pdf/GS1_General_Specifications.pdf" target="_blank" class="reference-link">
        <span>üìñ GS1 General Specifications (PDF)</span>
      </a>
    </div>
  </div>

  <script>
    let animationSpeed = 1;

    function showToast(message, type = 'error') {
      const toastContainer = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = type === 'error' ? 
        `<span style="margin-right:8px">‚ö†Ô∏è</span> ${message}` : 
        `<span style="margin-right:8px">‚úÖ</span> ${message}`;
      
      toast.addEventListener('click', () => {
        toast.classList.add('fade-out');
        setTimeout(() => toast.remove(), 300);
      });
      
      toastContainer.appendChild(toast);
      
      setTimeout(() => {
        if (toast.parentElement) {
          toast.classList.add('fade-out');
          setTimeout(() => toast.remove(), 300);
        }
      }, 3000);
    }

    document.querySelectorAll('.digit-input').forEach((input, index, inputs) => {
      input.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/[^0-9]/g, '');
        if (e.target.value.length > 1) e.target.value = e.target.value.slice(0, 1);
        if (e.target.value.length === 1 && index < inputs.length - 1) inputs[index + 1].focus();
      });

      input.addEventListener('keydown', (e) => {
        const allowedKeys = ['Backspace', 'Delete', 'Tab', 'Enter', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'];
        if (!/^[0-9]$/.test(e.key) && !allowedKeys.includes(e.key) && !(e.ctrlKey || e.metaKey)) {
          e.preventDefault();
          return;
        }
        if (e.key === 'Backspace' && e.target.value === '' && index > 0) inputs[index - 1].focus();
      });

      input.addEventListener('focus', (e) => e.target.select());
    });

    document.getElementById('speedSlider').addEventListener('input', (e) => {
      animationSpeed = parseFloat(e.target.value);
      document.getElementById('speedValue').textContent = animationSpeed + 'x';
    });

    function calculateCheckDigit(digits) {
      let sum = 0;
      for (let i = 0; i < 11; i++) {
        sum += parseInt(digits[i]) * (i % 2 === 0 ? 3 : 1);
      }
      return (10 - (sum % 10)) % 10;
    }

    function generateBarcode(upcCode) {
      if (typeof JsBarcode === 'undefined' || !upcCode || upcCode.length !== 12) return;
      try {
        JsBarcode("#barcodeDisplay", upcCode, {
          format: "UPC", width: 2, height: 60, lineColor: "#0f172a",
          background: "#ffffff", margin: 10, fontSize: 16, displayValue: true, font: "Inter"
        });
      } catch (e) { console.error(e); }
    }

    function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

    async function startConversion() {
      const inputs = Array.from(document.querySelectorAll('.digit-input'));
      const values = inputs.map(i => i.value);
      
      if (values.some(v => v === '')) {
        showToast('„Åô„Åπ„Å¶„ÅÆÊ°Å„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
        return;
      }

      disableUIElements();
      reset(false); // Don't clear inputs

      try {
        const [p1, p2, p3, p4, p5, p6] = values;
        const p6Value = parseInt(p6);

        // Setup UPCE Display
        const upceDisplay = document.getElementById('upceDisplay');
        values.forEach((v, i) => {
           const box = upceDisplay.children[i];
           box.textContent = v;
           box.className = `digit-box ${i < 5 ? 'source' : 'moved'} animating`;
        });

        // Pattern Info
        const patternInfo = document.getElementById('patternInfo');
        let patternId = p6Value <= 2 ? 'pattern0' : (p6Value === 3 ? 'pattern3' : (p6Value === 4 ? 'pattern4' : 'pattern5'));
        
        document.querySelectorAll('.pattern-row').forEach(r => r.classList.remove('active'));
        document.getElementById(patternId).classList.add('active');
        
        patternInfo.textContent = document.getElementById(patternId).textContent.split(':')[1].trim();
        patternInfo.classList.add('show');

        await sleep(400 / animationSpeed);
        document.getElementById('arrow').classList.remove('hidden');
        await sleep(400 / animationSpeed);

        // Calculate UPC-A
        let upcaDigits = ['0'];
        if (p6Value <= 2) upcaDigits.push(p1, p2, p6, '0', '0', '0', '0', p3, p4, p5);
        else if (p6Value === 3) upcaDigits.push(p1, p2, p3, '0', '0', '0', '0', '0', p4, p5);
        else if (p6Value === 4) upcaDigits.push(p1, p2, p3, p4, '0', '0', '0', '0', '0', p5);
        else upcaDigits.push(p1, p2, p3, p4, p5, '0', '0', '0', '0', p6);
        
        upcaDigits.push(calculateCheckDigit(upcaDigits).toString());

        const upcaBoxes = document.getElementById('upcaDisplay').children;

        // Animation Sequence
        // 1. Leading Zero
        upcaBoxes[0].textContent = '0';
        upcaBoxes[0].className = 'digit-box zero animating';
        await sleep(300 / animationSpeed);

        // 2. Source Digits (Blue)
        for (let i = 1; i < 11; i++) {
          if (upcaDigits[i] !== '0' && i !== (p6Value <= 2 ? 3 : 10)) {
            await sleep(100 / animationSpeed);
            upcaBoxes[i].textContent = upcaDigits[i];
            upcaBoxes[i].className = 'digit-box source animating';
          }
        }
        
        // 3. Moved P6 (Orange)
        await sleep(300 / animationSpeed);
        let p6Index = p6Value <= 2 ? 3 : (p6Value >= 5 ? 10 : -1);
        if (p6Index !== -1) {
          upcaBoxes[p6Index].textContent = upcaDigits[p6Index];
          upcaBoxes[p6Index].className = 'digit-box moved animating';
        }

        // 4. Zeros (Green)
        await sleep(300 / animationSpeed);
        for (let i = 1; i < 11; i++) {
          if (upcaDigits[i] === '0' && upcaBoxes[i].textContent === '') {
            upcaBoxes[i].textContent = '0';
            upcaBoxes[i].className = 'digit-box zero animating';
            await sleep(50 / animationSpeed);
          }
        }

        // 5. Check Digit (Pink)
        await sleep(300 / animationSpeed);
        const lastBox = upcaBoxes[11];
        lastBox.textContent = upcaDigits[11];
        lastBox.className = 'digit-box check animating';

        // Final Result
        await sleep(500 / animationSpeed);
        document.getElementById('resultSection').classList.add('show');
        generateBarcode(upcaDigits.join(''));

      } catch(e) {
        console.error(e);
      } finally {
        enableUIElements();
      }
    }

    function reset(clearInputs = true) {
      const upceDisplay = document.getElementById('upceDisplay');
      const upcaDisplay = document.getElementById('upcaDisplay');
      
      upceDisplay.innerHTML = '';
      upcaDisplay.innerHTML = '';
      
      for(let i=0; i<6; i++) upceDisplay.appendChild(createBox());
      for(let i=0; i<12; i++) upcaDisplay.appendChild(createBox());

      document.getElementById('patternInfo').classList.remove('show');
      document.getElementById('resultSection').classList.remove('show');
      document.querySelectorAll('.pattern-row').forEach(row => row.classList.remove('active'));

      if (clearInputs) {
        document.querySelectorAll('.digit-input').forEach(i => i.value = '');
        document.getElementById('p1').focus();
      }
    }

    function createBox() {
      const div = document.createElement('div');
      div.className = 'digit-box placeholder';
      return div;
    }

    function disableUIElements() {
      document.querySelectorAll('button, input').forEach(e => e.disabled = true);
    }

    function enableUIElements() {
      document.querySelectorAll('button, input').forEach(e => e.disabled = false);
    }

    window.addEventListener('DOMContentLoaded', () => reset());
  </script>
</body>
</html>